<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5293f0e00c92128969df.css" data-identity="gatsby-global-css">.main-banner{background:url(/static/main_img_mobile-2841f254ae2fa914a2b023058ec34a40.jpeg);background-attachment:fixed;background-position:50%;background-repeat:no-repeat;background-size:cover;position:relative}@media (min-width:1024px){.main-banner{background:url(/static/main_img-eeadbed90e9e217b1294abb9f86d0988.jpg)}}.main-banner .subtitle,.main-banner .title{color:#fff}.main-banner-shade{background:rgba(0,0,0,.3);bottom:0;left:0;position:absolute;right:0;top:0}</style><meta name="generator" content="Gatsby 4.0.2"/><script>window.dataLayer = window.dataLayer || [];window.dataLayer.push({"platform":"gatsby"}); (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'G-JTRSG8L60Z');</script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link data-react-helmet="true" rel="icon" href="/favicon.ico"/><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-8f42446ce8d0181e4dbc.js"/><link as="script" rel="preload" href="/framework-b755398cc8fa0d117e92.js"/><link as="script" rel="preload" href="/app-424ac0eb0fd6662108c3.js"/><link as="script" rel="preload" href="/2c3559a924fb44b3f652ff5b708b64a3c6f77a42-1062a5ec4f87343c995d.js"/><link as="script" rel="preload" href="/component---src-pages-blog-mdx-slug-js-2d98bb37e10054a690e0.js"/><link as="fetch" rel="preload" href="/page-data/blog/subqueries-and-join-functions/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-JTRSG8L60Z" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="navbar is-light" role="navigation" aria-label="main navigation"><div class="container is-max-desktop"><div class="navbar-brand"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/projects">Projects</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/cv">CV</a></div></div></nav><section class="hero is-medium main-banner"><div class="main-banner-shade"></div><div class="hero-body"><div class="container is-max-desktop"><h1 class="title">Subqueries and JOIN functions</h1><p class="subtitle is-6">Posted on <time dateTime="October 5, 2021">October 5, 2021</time></p></div></div></section><section class="section"><div class="container is-max-desktop"><article class="content"><p><strong>Subquery</strong> is a statement that appears inside another query statement. It is also called an inner or nested query. The inner query executes first, then the result is passed to the outer query to work with. The subquery can only have 1 column specified in the SELECT statement. We can write subquery after SELECT, FROM, or WHERE in the outer query.</p><pre><code>SELECT product,
    (SELECT AVG(price)
    FROM product_price) AS price
FROM product_price;
</code></pre><p>As an example, I would like to use the public dataset again (austin_bikeshare). We have a schema like this:</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <a class="gatsby-resp-image-link" href="/static/53b76d0c600723effc5bf63016075657/0e0c4/bikeshare_schema.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:53.37837837837838%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVQoz32R/Y7TMBDE8/aI90C8EX8diEt7DUkTJ43d+NseNAuueuiEpZHt1e7sb+3u28uA768j+vMEHxJk1YqUC4zNCDFDH0l2YxNiKriZBOf/xH+pAHMkTGuEDwXdOGsYo6GWGbVW3O93xBjF1/mCUgEXKnIBfKzIuf5tVOBCgY9FYjznUtGdhhXaWDhrse87jDGy09h7B6UUlFokrvcd3jnE4BGe5L1HjEGAOqVmGK2Rc8a2bXDO4TgOrOsqpM55iWmtxZzxEILkp5Qe4l0Mp2kSIga4sxsNWFhKQVskpiH3FqcB1e6sfxhy0YRnErKYia2AhMuy4Ha7SUPS/2vI+o5JwzDgOKy8E8chJcdnYhPJaMaG7Wma2TvD4fKG8/kEa61QtTckeSOkaHK9XoWSYuMPCcd5w2VcYJ0TU++DJJOW79pM2YiUFD/hme6d4acvZ3z+esEwHwj+DmsPKQohPj6kkfxPXJyiez0NePnRY91uOA0bfr6tUOuOaRrR972M90zDcyP/SL8BU45UapoEKOoAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Bikeshre_trips table schema" title="Bikeshre_trips table schema" src="/static/53b76d0c600723effc5bf63016075657/fcda8/bikeshare_schema.png" srcSet="/static/53b76d0c600723effc5bf63016075657/12f09/bikeshare_schema.png 148w,/static/53b76d0c600723effc5bf63016075657/e4a3f/bikeshare_schema.png 295w,/static/53b76d0c600723effc5bf63016075657/fcda8/bikeshare_schema.png 590w,/static/53b76d0c600723effc5bf63016075657/efc66/bikeshare_schema.png 885w,/static/53b76d0c600723effc5bf63016075657/c83ae/bikeshare_schema.png 1180w,/static/53b76d0c600723effc5bf63016075657/0e0c4/bikeshare_schema.png 1884w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><p>Let’s say we want to find the start station and the number of trips from there, but we are only interested in trips that are longer than 60 minutes. So in the subquery, we filter out all the trips that were shorter than 60 minutes and aliasing this subquery as longest_trips. After this, we can refer to it like to the independent table and count the number of trips while grouping the station id.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <a class="gatsby-resp-image-link" href="/static/5c90cee10c4102352b53f3639595690d/6c2de/bikeshare_query.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:72.2972972972973%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6ElEQVQ4y42TSZLUMBBFfVlOw4J7sOIArNj2soGgq5nK5Vm2JVseZNnyI6SqrgCioUsRL5Qa/KX8aUVx1vLj1HJMW7JS8vOYkKQF1q4459j3M3/H/yLq9cybtwmvXn/l/V1DUU8c4gEhDdZaUjFzKicWaxHKhHiYFpbleSJrF+4+N7z7UHE49rRqoBKCum7olEKIBikHVKfJsgope3SvcduG29yl39jWjXVdiYwxsM3sbiPJa9KiJS8bkqIkrXLSMiNrGlIhyEWBNiNq7JlWw2BnpnVhXhfc7vAt8mnNs0ENDjVCJgaKsqGWkqTKabqWXnfUvSYXJVVbU3cSs1lGa4LYH4J935NlGZ8eS77Hgo/39xRFztArum7GLA72nd153KXf2ff9PH9ZuxYlz3MOhwOPhwceHr7gx8ti0ZMN5o+zZV1tKJD3yGOv2Gvs5719IeW2bVFK0TTN+WSgm3b0vDOa89hdbvUSQdDjS248ZmaeRhZjQuzxa77dJOg3DsOAlAqte/RoUXrBe+tppQwZTNPELS3yqVZVRRzHFHlGnDV8OwrGYQgHeVG/p+u64NFLBEGtdfggSVKqsiRJTmHxqQjXYlzs+R+R/wefmpTynGbbBgHvye/v9CYPe/+MLpufbuur/ZzgLfwCxHQ7fYV0yOgAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Bikeshre_trips query" title="Bikeshre_trips query" src="/static/5c90cee10c4102352b53f3639595690d/fcda8/bikeshare_query.png" srcSet="/static/5c90cee10c4102352b53f3639595690d/12f09/bikeshare_query.png 148w,/static/5c90cee10c4102352b53f3639595690d/e4a3f/bikeshare_query.png 295w,/static/5c90cee10c4102352b53f3639595690d/fcda8/bikeshare_query.png 590w,/static/5c90cee10c4102352b53f3639595690d/efc66/bikeshare_query.png 885w,/static/5c90cee10c4102352b53f3639595690d/c83ae/bikeshare_query.png 1180w,/static/5c90cee10c4102352b53f3639595690d/6c2de/bikeshare_query.png 1334w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><p>Also, sometimes subquery is used instead of a <strong>JOIN</strong> function, so with its help, we can get the data from both tables.
From the performance point of view, a subquery is executed slower than JOIN.
We are using the JOIN function to join 2 or more tables. There are different types of JOIN:
An <strong>INNER JOIN or JOIN</strong> is a function that returns records with matching values in both tables.
A <strong>LEFT JOIN</strong> is a function that will return all the records from the left table and only the matching records from the right table.
<strong>RIGHT JOIN</strong> does the opposite. It will return all records from the right table and only the matching records from the left.
<strong>FULL OUTER JOIN</strong> combines RIGHT and LEFT JOIN to return all records in both tables.
There is also a <strong>CROSS JOIN</strong> (or cartesian), it returns all rows joined from both sides.
For example, if we have 2 rows in table_1 and 10 rows in table_2. Executing CROSS JOIN on both tables will give us 1 table with 20 rows without any matching.</p><p>There is also self-join when you join the same table and aliasing it 2 names. Usually, it is made to find a row-dependant relationship. An example of it:</p><pre><code>SELECT e.LastName AS Employees, m.LastName AS Managers
FROM Employees e LEFT JOIN Employees m
ON m.EmployeeId = e.ReportsTo;
</code></pre><p>However, it is advised to use the window function instead, as self-join can cause poor performance.</p></article></div></section><footer class="footer"><div class="content has-text-centered"><p><strong>Maryna Demchenko&#x27;s</strong> website. I use this website to share my experience of becoming a data analyst.</p><p>Copyright © 2021</p><p>This website is built with <a target="_blank" href="https://www.gatsbyjs.com/">GatsbyJS</a> and <a target="_blank" href="https://bulma.io/">Bulma</a></p></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/subqueries-and-join-functions/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-592a7c3ce8e7b84d5c8b.js"],"app":["/app-424ac0eb0fd6662108c3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a7e17e1ee111fca70ee9.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-d93ff26dd0ddc58d0316.js"],"component---src-pages-blog-mdx-slug-js":["/component---src-pages-blog-mdx-slug-js-2d98bb37e10054a690e0.js"],"component---src-pages-cv-js":["/component---src-pages-cv-js-f37b96c3eac8c8fd5d2c.js"],"component---src-pages-index-js":["/component---src-pages-index-js-f4e11f0e0a2052bfe24c.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-acabcdfa11265847c235.js"]};/*]]>*/</script><script src="/polyfill-592a7c3ce8e7b84d5c8b.js" nomodule=""></script><script src="/component---src-pages-blog-mdx-slug-js-2d98bb37e10054a690e0.js" async=""></script><script src="/2c3559a924fb44b3f652ff5b708b64a3c6f77a42-1062a5ec4f87343c995d.js" async=""></script><script src="/app-424ac0eb0fd6662108c3.js" async=""></script><script src="/framework-b755398cc8fa0d117e92.js" async=""></script><script src="/webpack-runtime-8f42446ce8d0181e4dbc.js" async=""></script></body></html>